# Chap8. 입출력구조

## 8-1. 장치 컨트롤러와 장치 드라이버

다양한 외부 장치가 컴퓨터 내부와 어떻게 연결되고 소통하는지

### 장치 컨트롤러 - 하드웨어적 통로

- 입출력장치가 CPU, 메모리보다 다루기 까다로운 이유
    1. 입출력장치 종류가 매우 많음 → 정보를 주고받는 방식을 규격화하기가 어려움
    2. CPU와 입출력장치의 데이터 전송률이 낮음
- **장치 컨트롤러:** 입출력장치는 컴퓨터에 직접 연결되지 않고 각자의 **장치 컨트롤러**(= 입출력 제어기, 입출력 모듈)를 통해 연결됨
    - CPU와 입출력장치 간의 통신 중개
    - 오류 검출
    - **데이터 버퍼링**
        - 버퍼링: 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 버퍼라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법
- 장치 컨트롤러 내부
    - 데이터 레지스터
        - CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터 - 버퍼 역할
    - 상태 레지스터
        - 상태 정보(입출력 준비, 완료, 오류 등)
    - 제어 레지스터
        - 입출력장치가 수행할 내용에 대한 제어 정보와 명령

### 장치 드라이버 - 소프트웨어적 통로

- 장치 컨트롤러의 동작을 감지하고 제어해 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램

## 8-2. 다양한 입출력 방법

장치 컨트롤러가 CPU와 정보를 주고받는 방법

### 프로그램 입출력

![Screenshot 2023-07-16 at 4.25.37 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4017d6f9-44fe-49bd-b2b5-9e01e408d411/Screenshot_2023-07-16_at_4.25.37_PM.png)

- 프로그램 속 명령어로 입출력장치를 제어하는 방법
- CPU가 장치 컨트롤러의 레지스터를 아는 방법?
- **메모리 맵 입출력**
    - [메모리에 접근하기 위한 주소 공간]과 [입출력장치에 접근하기 위한 주소 공간]을 하나의 주소 공간으로 간주하는 방법
    - ex. ‘517번지(프린터 컨트롤러의 상태 레지스터)를 읽어라’, ‘518번지(하드 디스크 컨트롤러의 데이터 레지스터)에 a를 써라’
    - 모두 똑같이 메모리 주소를 대하듯 하면 됨. 메모리 접근과 입출력장치 접근 명령어가 다를 필요가 없음
- **고립형 입출력**
    - 메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법
    - 메모리 접근 명령어 ≠ 입출력장치 접근 명령어

### 인터럽트 기반 입출력

- CPU는 장치 컨트롤러에 입출력 작업을 명령, 입출력 작업 완료 뒤엔 CPU에게 인터럽트 요청 신호를 보내고 CPU는 하던 일 백업 후 인터럽트 서비스 루틴 실행
(입출력장치에 의한 하드웨어 인터럽트는 장치 컨트롤러에 의해 발생)
- 여러 입출력장치에서 인터럽트가 동시에 발생한 경우 처리는?
    - 우선순위가 높은 인터럽트 순으로 (플래그 레지스터 속 인터럽트 비트가 활성화된 경우, NMI가 발생한 경우)
    - ⇒ **프로그래머블 인터럽트 컨트롤러(PIC)**: 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청들의 우선순위 판별 뒤 가장 먼저 처리할 인터럽트를 CPU에 알려주는 장치

### DMA 입출력

- CPU를 거치지 않고도 입출력장치와 메모리가 상호작용할 수 있는 입출력 방식
- DMA 컨트롤러라는 하드웨어가 필요함
- **DMA 입출력 과정**
    1. CPU는 DMA 컨트롤러에 입출력 작업을 명령
    2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업 수행, 필요한 경우 메모리에 직접 접근
    3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알림
- **입출력 버스**
    - DMA를 위해 시스템 버스를 너무 자주 사용하면 그만큼 CPU는 이용하지 못함(사이클 스틸링)
    - DMA 컨트롤러와 장치 컨트롤러들을 별도의 입출력 버스에 연결하여 해결 - PCI, PCI Express(PCIe)
