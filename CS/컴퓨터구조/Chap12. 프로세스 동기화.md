# Chap12. 프로세스 동기화

## 12-1. 동기화란

### 동기화의 의미

- **프로세스 동기화**: 프로세스들 사이의 수행 시기를 맞추는 것
    - 실행 순서 제어: 프로세스를 올바른 순서대로 실행하기 (ex. Writer가 먼저 책을 써야 Reader가 읽을 수 있음)
    - 상호 배제: 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기 (ex. 계좌에 2만원과 5만원을 동시에 입금할 경우 읽어들인 잔액이 같다면?)

### 생산자와 소비자 문제

- 생산자를 100,000번, 소비자를 100,000번 동시에 실행하면 - 총합 이라는 데이터를 동시에 사용하는데 서로의 작업이 끝나기도 전에 자신의 작업을 수행하므로 오류가 남

### 공유 자원과 임계 구역

- **공유 자원**: 공동의 자원 (ex. 잔액, 총합)
- **임계 구역**: 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역. 둘 중 하나는 대기해야 함
- **레이스 컨디션**: 잘못된 실행으로 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우
    - 근본적인 문제? 컴퓨터는 저급 언어를 실행. 고급 언어 한 줄을 실행하는 과정에서 문맥 교환 발생
- 세 가지 원칙
    - 상호 배제: 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
    - 진행: 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
    - 유한 대기: 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다. (무한정 대기 X)

## 12-2. 동기화 기법

### 뮤텍스 락

- 뮤텍스 락: 상호 배제를 위한 동기화 도구 (ex. 탈의실(임계 구역)의 자물쇠)
    - lock: 자물쇠 역할. 프로세스들이 공유하는 전역 변수
    - acquire 함수: 임계 구역을 잠그는 역할. 잠겨있다면 열릴 때까지 반복적으로 확인(바쁜 대기)
    - release 함수: 임계 구역의 잠금을 해제하는 역할

### 세마포

- 공유 자원이 여러 개 있을 경우
- 세마포: 멈춤 신호와 가도 좋다는 신호
    - 전역 변수 S: 임계 구역에 진입할 수 있는 프로세스의 개수(사용 가능한 공유 자원의 개수)
    - wait 함수: 임계 구역에 들어가도 좋은지, 기다려야 할지 알려줌
        - S가 0이하라면 - 사용 가능 자원이 있는지 반복적으로 확인 - S가 1 이상이면 S를 1 감소 후 임계 구역 진입
        - 사용할 수 있는 자원이 없을 경우 해당 프로세스 상태를 대기 상태로 만들고, 세마포를 위한 대기 큐에 집어넣음
    - signal 함수: 임계 구역 앞에서 기다리는 프로세스에 ‘가도 좋다’는 신호를 줌
        - 임계 구역에서의 작업을 마친 뒤 S++
- 매번 임계 구역 앞뒤로 일일이 wait, signal 함수 명시하기 번거롭고 잘못된 코드가 발생할 수도 있음

### 모니터

- 공유 자원과 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리. 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 함
- 모니터 안에 항상 하나의 프로세스만 들어오도록 하여 상호 배제를 위한 동기화 제공
- 조건 변수: 특정 조건을 바탕으로 프로세스 실행/일시 중단
    - wait 연산: 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 큐에 삽입
