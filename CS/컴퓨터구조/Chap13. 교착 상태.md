# Chap13. 교착 상태

## 13-1. 교착 상태란

### 식사하는 철학자 문제

1 계속 생각을 하다가 왼쪽 포크가 사용 가능하면 집어든다. 
2 계속 생각을 하다가 오른쪽 포크가 사용 가능하면 집어든다.
3 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 한다. 
4 식사 시간이 끝나면 오른쪽 포크를 내려놓는다.
5 오른쪽 포크를 내려놓은 뒤 왼쪽 포크를 내려놓는다.
6 다시 1번부터 반복한다.

- 교착 상태: 일어나지 않을 사건을 기다리며 진행이 멈춰 버리는 현상
- ex. 자원 A를 점유한 게임 ↔ 자원 B를 점유한 웹 브라우저
- 해결하기 위해서는? 1. 교착 상태가 발생했을 때의 상황 정확히 표션 2. 교착 상태가 일어나는 근본적인 이유 알기

### 자원 할당 그래프

- 자원 할당 그래프: 어떤 프로세스가 어떤 자원을 사용하고 기다리고 있는지 표현
    
    ![Screenshot 2023-07-19 at 7.51.25 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d4e805f4-8813-485d-8fcf-a6c07498c614/Screenshot_2023-07-19_at_7.51.25_PM.png)
    
    - 프로세스는 원, 자원의 종류는 사각형으로 표현
    - 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현
    - 자원을 사용 중이라면 자원에서 프로세스를 향해 화살표 표시
    - 자원을 기다리고 있다면 프로세스에서 자원으로 화살표 표시

### 교착 상태 발생 조건

조건이 모두 만족될 때 교착 상태가 발생할 가능성이 생김. 하나라도 만족하지 않으면 발생하지 않음.

- 상호 배제
    - 한 번에 하나의 프로세스만 이용 가능했기 때문
- 점유와 대기
    - 자원을 할당받은 상태에서 다른 자원을 할당받기를 기다리는 상태
- 비선점
    - 자원을 강제로 빼앗지 못함
- 원형 대기
    - 프로세스들이 원의 형태로 자원을 대기하는 것

## 13-2. 교착 상태 해결 방법

예방, 회피, 검출 후 회복

### 교착 상태 예방

교착 상태 발생 필요 조건 네 가지 중 하나를 충족하지 못하게 하는 방법과 같음 → 부작용 O

- 자원의 상호 배제?
    - (-) 모든 자원의 상호 배제를 없애기는 현실적으로 어려움
- 점유와 대기?
    - 특정 프로세스에 자원을 모두 할당 / 아예 할당하지 않음
    - (-) 자원의 활용률이 낮아질 수 있음
    - (-) 많은 자원을 사용하는 프로세스가 불리해지고 기아 현상 발생 가능
- 비선점 조건?
    - 자원을 이용 중인 프로세스로부터 해당 자원을 빼앗기
    - 선점하여 사용할 수 있는 일부 자원에서는 효과적
    - (-) 한 번에 하나의 프로세스만 이용 가능한 자원도 있음 - 범용성이 떨어짐
- 원형 대기 조건?
    - 모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당
    - (-) 수많은 자원에 번호를 붙이기 힘듦, 활용류 떨어질 수 있음

### 교착 상태 회피

- 교착 상태 회피: 교착 상태가 발생하지 않을 정도로만 조금씩 자원을 할당하는 방식
    - 교착 상태가 한정된 자원의 무분별한 할당으로 인해 발생한다고 간주 (ex. 포크 100개 중 2개와 5개 중 2개)
- 안전 상태: 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태
- 불안전 상태: 교착 상태가 발생할 수도 있는 상황 (안전 순서열이 없는 상황)
- 안전 순서열: 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서

![Screenshot 2023-07-19 at 8.43.59 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9911fd05-32a6-4527-afb4-1f78173d9d08/Screenshot_2023-07-19_at_8.43.59_PM.png)

![Screenshot 2023-07-19 at 8.44.12 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/72ef474e-2365-49a7-977e-fba56d84f62b/Screenshot_2023-07-19_at_8.44.12_PM.png)

### 교착 상태 검출 후 회복

교착 상태 발생을 인정하고 사후에 조치하는 방식

운영체제는 프로세스들이 자원을 요구할 때마다 그때그때 모두 할당, 교착 상태 발생 여부를 주기적으로 검사

- 선점을 통한 회복
    - 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
- 프로세스 강제 종료를 통한 회복
    - 교착 상태에 놓인 프로세스를 모두 강제 종료
        - 가장 확실하지만 많은 프로세스가 작업 내역을 잃게 될 수도
    - 교착 상태가 없어질 때까지 한 프로세스씩 강제 종료
        - 작업 내역을 잃는 프로세스가 줄지만 교착 상태 여부 확인 과정에서 오버헤드 일어날 수도

- 타조 알고리즘
    - 교착 상태를 무시하는 방법
